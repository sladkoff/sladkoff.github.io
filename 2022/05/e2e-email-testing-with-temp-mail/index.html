<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="The Problem You have a web app that sends out emails using a service like SendGrid or similar when a user signs up. It&amp;rsquo;s actually not important how the mail delivery is implemented. You want to test that an email is delivered at all using an automated test runner like Cypress.
This is what the sign-up implementation could look like.
Note that we don&amp;rsquo;t want to reconfigure the app under test to use a different mail API or SDK (like MailTrap) to reroute our whole mailing traffic via a different service."><meta name=keywords content=",testing,email"><meta name=robots content="noodp"><meta name=theme-color content="#2ecc71"><link rel=canonical href=https://blog.sldk.de/2022/05/e2e-email-testing-with-temp-mail/><title>E2E email testing with temp-mail :: Leonid Koftun — Software Engineer</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=https://blog.sldk.de/main.d7bdd8ee18bfbf4c605488a7e5b1b92cd980dfeed2bdaeab4dd5e931a7a78bc0.css><link rel=stylesheet type=text/css href=https://blog.sldk.de/css/prism.css><link rel=stylesheet type=text/css href=https://blog.sldk.de/css/style.css><meta itemprop=name content="E2E email testing with temp-mail"><meta itemprop=description content="The Problem You have a web app that sends out emails using a service like SendGrid or similar when a user signs up. It&rsquo;s actually not important how the mail delivery is implemented. You want to test that an email is delivered at all using an automated test runner like Cypress.
This is what the sign-up implementation could look like.
Note that we don&rsquo;t want to reconfigure the app under test to use a different mail API or SDK (like MailTrap) to reroute our whole mailing traffic via a different service."><meta itemprop=datePublished content="2022-05-25T00:00:00+00:00"><meta itemprop=dateModified content="2022-05-26T00:04:58+02:00"><meta itemprop=wordCount content="632"><meta itemprop=image content="https://blog.sldk.de"><meta itemprop=keywords content="testing,email,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.sldk.de"><meta name=twitter:title content="E2E email testing with temp-mail"><meta name=twitter:description content="The Problem You have a web app that sends out emails using a service like SendGrid or similar when a user signs up. It&rsquo;s actually not important how the mail delivery is implemented. You want to test that an email is delivered at all using an automated test runner like Cypress.
This is what the sign-up implementation could look like.
Note that we don&rsquo;t want to reconfigure the app under test to use a different mail API or SDK (like MailTrap) to reroute our whole mailing traffic via a different service."><meta property="article:published_time" content="2022-05-25 00:00:00 +0000 UTC"><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=sldk data-description="Support me on Buy me a coffee!" data-message data-color=#f05f70 data-position=Right data-x_margin=18 data-y_margin=18></script><script data-goatcounter=https://sldk.goatcounter.com/count async src=//gc.zgo.at/count.js></script></head><body><div class=container><header class=header><span class=header__inner><a href=https://blog.sldk.de/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ cd /home/</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://blog.sldk.de/about>About</a></li><li><a href=https://blog.sldk.de/posts>Posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>3 minutes</p></div><article><h1 class=post-title><a href=https://blog.sldk.de/2022/05/e2e-email-testing-with-temp-mail/>E2E email testing with temp-mail</a></h1><hr><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#the-problem>The Problem</a></li><li><a href=#the-solution>The solution</a><ul><li><a href=#why-not-aliases>Why not aliases?</a></li><li><a href=#why-not-mailtrap>Why not MailTrap?</a></li></ul></li></ul></nav></aside><hr><div class=post-content><h2 id=the-problem>The Problem</h2><p>You have a web app that sends out emails using a service like SendGrid or similar when a user signs up. It&rsquo;s actually not important how the mail delivery is implemented. You want to test
that an email <em>is</em> delivered at all using an <em>automated</em> test runner like Cypress.</p><p>This is what the sign-up implementation could look like.</p><p><img src=https://blog.sldk.de/img/generated/e2e-email-sequence.svg alt=diagram></p><p>Note that we don&rsquo;t want to reconfigure the app under test to use a <strong>different</strong> mail API or SDK (like <a href>MailTrap</a>) to reroute our whole mailing traffic via a different service. We don&rsquo;t do that because that essentially prevents us from truly testing the app end-to-end.</p><h2 id=the-solution>The solution</h2><p>Let&rsquo;s first have a look at our high level test spec.</p><ol><li><strong>Given</strong> a new email address and password</li><li><strong>When</strong> I sign up to my app</li><li><strong>Then</strong> I want to receive an email</li></ol><p>In Step 2 we will need to provide a valid email
for our app. In step 3 we will need to check that an email arrived so we need some sort of mailbox. Let&rsquo;s define some requirements for our mailbox.</p><ol><li>The mailbox should give us <strong>unique</strong> addresses to use per test.</li><li>The mailbox should require <strong>minimal manual configuration</strong>.</li><li>The mailbox should be accessible via an <strong>API</strong>.</li><li>The mailbox should be <strong>cheap af</strong>.</li></ol><p><strong><a href=https://1secmail.com>1secmail.com</a> to the rescue!</strong></p><p>The web version looks quite hideous but it has a really simple <a href=https://www.1secmail.com/api/>API</a>.</p><p>It basically functions as a catch-all email mailbox. So you don&rsquo;t need to <em>create</em> temp addresses.
You can <em>use</em> any temp address in your tests (e.g. during sign-up).
You can then use the temp address as <em>key</em> to fetch email for the temp address.</p><p>So our automated test looks like this under the hood.</p><ul><li>Generate a temp email address like <code>test-user-${unique-suffix}@1secmail.com</code> (no API call necessary)</li><li>Use the generated temp email address in the test to sign up to the app under test</li><li>Check for mails using the 1secmail API</li></ul><p>Here&rsquo;s an example axios implementation of the API call:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>suffix</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>faker</span>.<span style=color:#a6e22e>random</span>.<span style=color:#a6e22e>numeric</span>(<span style=color:#ae81ff>8</span>)

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Message</span> <span style=color:#f92672>=</span> {
  <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>string</span>
  <span style=color:#66d9ef>from</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>string</span>
  <span style=color:#a6e22e>subject</span>: <span style=color:#66d9ef>string</span>
  <span style=color:#a6e22e>date</span>: <span style=color:#66d9ef>string</span>
}

<span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getMessages</span>(
  <span style=color:#a6e22e>login</span>: <span style=color:#66d9ef>string</span>,
  <span style=color:#a6e22e>domain</span>: <span style=color:#66d9ef>string</span>
)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>Message</span><span style=color:#960050;background-color:#1e0010>[]</span>&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>axios</span>.<span style=color:#66d9ef>get</span>&lt;<span style=color:#f92672>Message</span><span style=color:#960050;background-color:#1e0010>[]</span>&gt;(
    <span style=color:#e6db74>&#39;https://www.1secmail.com/api/v1/&#39;</span>,
    {
      <span style=color:#a6e22e>params</span><span style=color:#f92672>:</span> {
        <span style=color:#a6e22e>login</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`test-user-</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>suffix</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
        <span style=color:#a6e22e>domain</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;1secmail.com&#39;</span>,
      },
    }
  )
  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>data</span>
}
</code></pre></div><p>Let&rsquo;s double check if this approach fulfils our defined requirements.</p><ul><li><input checked disabled type=checkbox> We get <strong>unique</strong> temporary addresses per test.</li><li><input checked disabled type=checkbox> The mailbox is catch-all so <strong>no configuration</strong> is necessary.</li><li><input checked disabled type=checkbox> There&rsquo;s a <strong>simple API</strong>.</li><li><input checked disabled type=checkbox> It&rsquo;s <strong>free</strong>.</li></ul><p>Note: the public nature of this (anyone can read any temp mailbox) makes this unsuitable for tests where some sort of sensitive data is exchanged.</p><h3 id=why-not-aliases>Why not aliases?</h3><p>You could create an email address at a public email provider like Protonmail.</p><p>You could use unique aliases for each test like <code>test-user+timestamp@protonmail.com</code>.</p><p>I know they do have some sort of public API for you to use in your automated tests.</p><p>You can get probably get away with this for quite some time. My previous setup involved
a prepared email address with aliases at Protonmail. Unfortunately they terminated my account
due to a violation of their TOS - apparently you&rsquo;re not allowed to use automated software
to spam their system. Who would have thought.</p><h3 id=why-not-mailtrap>Why not MailTrap?</h3><p>MailTrap looks promising because it&rsquo;s supposed to be an email testing service but it&rsquo;s not
suited for real E2E tests on production if you&rsquo;re not willing to pay premium cash.
You don&rsquo;t get any public email address up until the Business plan which costs 50$ / month!</p><p>In other words, the lower tier plans only allow you to include MailTrap&rsquo;s SDK into your app
or use SMTP to send mail directly to MailTrap. This is not E2E testing because you&rsquo;re modifying
the app&rsquo;s configuration.</p><p>Basically it&rsquo;s useless and I was disappointed enough to write them a mail when I found out about this&mldr;</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://blog.sldk.de/tags/testing/>testing</a></span>
<span class=tag><a href=https://blog.sldk.de/tags/email/>email</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>632 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2022-05-25 00:00 +0000
(Last updated: 2022-05-25 22:04 +0000)</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=https://github.com/sladkoff/sladkoff.github.io/commit/70fb2d72b468fc983cd75900d24bff8ff9d2688b target=_blank rel=noopener>70fb2d7</a>
@ 2022-05-25</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read More</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://blog.sldk.de/2023/12/aws-api-gateway-authorizer-patterns/><span class=button__icon>←</span>
<span class=button__text>AWS API Gateway Authorizer Patterns</span></a></span>
<span class="button next"><a href=https://blog.sldk.de/2021/03/handling-secrets-in-flux-v2-repositories-with-sops/><span class=button__text>Handling secrets in Flux v2 repositories with SOPS</span>
<span class=button__icon>→</span></a></span></div></div><div id=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"blog-sldk-de"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2023</span>
<span><a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></span><span><a href=https://blog.sldk.de/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=https://blog.sldk.de/bundle.min.af435e44374f1e99a669ea8cd5bb9a2fceed80588941a451bfddb66b86a67c9f40b0f417e9543a763f809aa7e9300d7b1d69bf99615810ba02ac70396d50fad5.js integrity="sha512-r0NeRDdPHpmmaeqM1buaL87tgFiJQaRRv922a4amfJ9AsPQX6VQ6dj+AmqfpMA17HWm/mWFYELoCrHA5bVD61Q=="></script><script src=https://blog.sldk.de/js/prism.js></script></body></html>